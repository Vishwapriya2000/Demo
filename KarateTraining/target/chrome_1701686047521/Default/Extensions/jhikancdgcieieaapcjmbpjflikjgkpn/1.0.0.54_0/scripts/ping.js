const CHANNEL="Channel",MACHINE_ID="MachineID",DPC="DPC",MARKET="Market",PARTNER_CODE="PartnerCode";var bingUrl="https://www.bing.com/",browserDefaultsUrl="https://browserdefaults.microsoft.com/",chromeWS="https://chrome.google.com/",feedbackFwlink="https://go.microsoft.com/fwlink/?linkid=2138838",defaultPC="U519",market=chrome.i18n.getMessage("ExtnMarket"),extensionId=chrome.runtime.id,machineID=null==localStorage.MachineID||""==localStorage.MachineID||null==localStorage.MachineID?guid():localStorage.MachineID;function guid(){function e(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var o=e()+e()+e()+e()+e()+e()+e()+e();return o=o.toLocaleUpperCase(),localStorage[MACHINE_ID]=o,chrome.storage.local.set({[MACHINE_ID]:o}),o}function SendPingDetails(e){var o=chrome.runtime.getManifest(),a=o.version,t=navigator.userAgent.indexOf("("),r=navigator.userAgent.indexOf(")"),l=navigator.userAgent.substring(t+1,r).replace(/\s/g,""),c=localStorage.bmkt?localStorage.bmkt:navigator.language,n=o.name.replace(/ /g,"").replace("&","and"),i=navigator.userAgent.substr(navigator.userAgent.indexOf("Chrome")).split(" ")[0].replace("/","");setTimeout((function(){var o="http://g.ceipmsn.com/8SE/44?",t="TV=is"+(null==localStorage.pc||""==localStorage.pc||null==localStorage.pc?"U519":localStorage.pc)+"|pk"+n+"|tm"+c+"|bv"+i+"|ex"+extensionId+"|es"+e;localStorage.channel&&(t=t+"|ch"+localStorage.channel),localStorage._dpc&&(t=t+"|dp"+localStorage._dpc),o=o+"MI="+machineID+"&LV="+a+"&OS="+l+"&TE=37&"+t,o=encodeURI(o);var r=new XMLHttpRequest;r.open("GET",o,!0),r.send()}),500)}function getChromeWSChannel(e){var o="",a="",t="",r="",l="",c=e.split(".");if(""!=c[c.length-1]){var n=c[c.length-1].split("|");for(i=0;i<n.length;i++){var s=n[i].split("=");"utmcsr"==s[0]?o=s[1]:"utmccn"==s[0]?a=s[1]:"utmcmd"==s[0]?t=s[1]:"utmcct"==s[0]&&(r=s[1])}return"bgads"==o&&(l=o,"(not%20set)"!=t&&"(direct)"!=t&&"(organic)"!=t&&(l=l+"_"+t),"(not%20set)"!=a&&"(direct)"!=a&&"(organic)"!=a&&(l=l+"_"+a),"(not%20set)"!=r&&"(direct)"!=r&&"(organic)"!=r&&""!=r&&(l=l+"_"+r)),l}}function extractQueryString(e,o){e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");var a=new RegExp("[\\?&]"+e+"=([^&#]*)").exec(o);return null===a?"":a[1]}setTimeout((function(){chrome.cookies.set({url:bingUrl,domain:".bing.com",name:"_NTPC",value:localStorage.pc?localStorage.pc:defaultPC,sameSite:"no_restriction",secure:!0},(function(e){})),localStorage.isInstalled||(localStorage.isInstalled="done",machineID=localStorage[MACHINE_ID],chrome.storage.local.set({MigratedLocalStorage:!0}),SendPingDetails("1"),console.log("Extension isInstalled"));var e=localStorage._dpc?localStorage._dpc:"organic";null!=e&&""!=e&&null!=e&&chrome.cookies.set({url:bingUrl,domain:".bing.com",name:"_DPC",value:e,sameSite:"no_restriction",secure:!0},(function(e){}));var o=feedbackFwlink+"&extnID="+extensionId+"&mkt="+market+"&mid="+machineID+"&br=gc";chrome.runtime.setUninstallURL(o)}),900),setTimeout((function(){if(!localStorage.pc){console.log("registry");var e="",o="",a="registry",t="";chrome.cookies.get({url:browserDefaultsUrl,name:chrome.runtime.id},(function(r){if(r){for(var l=String(r.value).split("&"),c=0;c<l.length;c++){var n=l[c].split("=");"MI"==n[0].toLocaleUpperCase()?e=n[1]:"CH"==n[0].toLocaleUpperCase()?a=n[1]:"PC"==n[0].toLocaleUpperCase()?o=n[1]:"BM"==n[0].toLocaleUpperCase()&&(t=n[1])}chrome.cookies.remove({url:browserDefaultsUrl,name:chrome.runtime.id})}})),setTimeout((function(){var r={};""!=o?(localStorage.pc=o,chrome.storage.local.set({qspc:o}),r[PARTNER_CODE]=o):(localStorage.pc=defaultPC,r[PARTNER_CODE]=defaultPC),""!=e&&(localStorage[MACHINE_ID]=e,r[MACHINE_ID]=e),localStorage.channel=a,r[CHANNEL]=localStorage.channel,""!=t&&(localStorage.bmkt=t,r[MARKET]=t),""!=o?(localStorage._dpc=o+"_"+localStorage.channel,r[DPC]=o+"_"+localStorage.channel):(localStorage._dpc=localStorage.channel,r[DPC]=localStorage.channel),chrome.storage.local.set(r)}),100)}}),500),chrome.runtime.onInstalled.addListener((function(e){if("install"==e.reason){console.log("install");var o="",a="",t="organic",r="";chrome.cookies.get({url:browserDefaultsUrl,name:chrome.runtime.id},(function(e){if(e){for(var l=String(e.value).split("&"),c=0;c<l.length;c++){var n=l[c].split("=");"MI"==n[0].toLocaleUpperCase()?o=n[1]:"CH"==n[0].toLocaleUpperCase()?t=n[1]:"PC"==n[0].toLocaleUpperCase()?a=n[1]:"BM"==n[0].toLocaleUpperCase()&&(r=n[1])}chrome.cookies.remove({url:browserDefaultsUrl,name:chrome.runtime.id})}})),chrome.cookies.get({url:chromeWS,name:"__utmz"},(function(e){if(e){var o=getChromeWSChannel(e.value);""!=o&&(t=o),chrome.cookies.remove({url:chromeWS,name:"__utmz"})}})),setTimeout((function(){var e={};""!=a?(localStorage.pc=a,chrome.storage.local.set({qspc:a}),e[PARTNER_CODE]=a):(localStorage.pc=defaultPC,e[PARTNER_CODE]=defaultPC),""!=o&&(localStorage[MACHINE_ID]=o,e[MACHINE_ID]=o),localStorage.channel=t,e[CHANNEL]=localStorage.channel,""!=r&&(localStorage.bmkt=r,e[MARKET]=r),""!=a?(localStorage._dpc=a+"_"+localStorage.channel,e[DPC]=a+"_"+localStorage.channel):(localStorage._dpc=localStorage.channel,e[DPC]=localStorage.channel),chrome.storage.local.set(e)}),100),setTimeout((function(){var e="https://go.microsoft.com/fwlink/?linkid=2128904&trackingid="+chrome.runtime.id+"&partnercode="+localStorage.pc+"&browser=gc&mkt="+market;null!=localStorage.channel&&""!=localStorage.channel&&null!=localStorage.channel&&(e+="&channel="+localStorage.channel),null!=localStorage[MACHINE_ID]&&""!=localStorage[MACHINE_ID]&&null!=localStorage[MACHINE_ID]&&(e+="&machineid="+localStorage[MACHINE_ID]),chrome.tabs.create({url:e})}),600)}else if("update"==e.reason){localStorage.ChangeItback="False";var l={};localStorage._dpc&&(l[DPC]=localStorage._dpc),localStorage[MACHINE_ID]&&(l[MACHINE_ID]=localStorage[MACHINE_ID]),localStorage.channel&&(l[CHANNEL]=localStorage.channel),localStorage.bmkt&&(l[MARKET]=localStorage.bmkt),localStorage.pc&&(l[PARTNER_CODE]=localStorage.pc),chrome.storage.local.set(l),chrome.storage.local.set({MigratedLocalStorage:!0}),SendPingDetails("3")}})),chrome.tabs.onActivated.addListener((function(){""!=localStorage.PingDate&&localStorage.PingDate==(new Date).toDateString()||(SendPingDetails("2"),localStorage.PingDate=(new Date).toDateString())})),chrome.browserAction.onClicked.addListener((function(e){var o="https://www.msn.com/?pc="+defaultPC+"&ocid=MSNHP_"+defaultPC;localStorage.pc&&(o="https://www.msn.com/?pc="+localStorage.pc+"&ocid=MSNHP_"+localStorage.pc),chrome.tabs.create({url:o})})),chrome.webRequest.onBeforeRequest.addListener((function(e){var o=extractQueryString("pc",e.url),a=extractQueryString("form",e.url),t=extractQueryString("q",e.url);localStorage.pc&&(o=localStorage.pc);var r,l="https://www.msn.com/?pc="+(r=o)+"&ocid=MSNHP_"+r;return""!=a&&(l=function(e,o){return"https://www.bing.com/search?form=BGGCDF&pc="+o+"&q="+e}(t,o)),{redirectUrl:l}}),{urls:["*://www.bing.com/search?form=BGGCMF&pc=U519*","*://www.msn.com/?pc=U519&osmkt=*"]},["blocking"]),chrome.runtime.onMessage.addListener((function(e){"setMachineID"==e&&chrome.cookies.set({url:browserDefaultsUrl,domain:".browserdefaults.microsoft.com",name:"MachineID",value:localStorage[MACHINE_ID],sameSite:"no_restriction",secure:!0},(function(e){}))}));